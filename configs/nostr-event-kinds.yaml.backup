# Nostr Event Kinds Quality Control Configuration
# This file defines the structure and quality control rules for each Nostr event kind

event_kinds:
  # Basic event kinds (NIP-01)
  0: # User metadata
    name: "User Metadata"
    description: "User profile information"
    required_tags: []
    optional_tags: ["d"]
    content_validation:
      type: "json"
      required_fields: ["name"]
      optional_fields: ["about", "picture", "banner", "website", "lud16", "nip05"]
      max_length: 1000
    quality_rules:
      - name: "valid_json"
        weight: 1.0
        description: "Content must be valid JSON"
      - name: "has_name"
        weight: 0.8
        description: "Must have a name field"
      - name: "reasonable_length"
        weight: 0.6
        description: "Content length should be reasonable"
    replaceable: true
    ephemeral: false

  1: # Text note
    name: "Text Note"
    description: "Regular social media post"
    required_tags: []
    optional_tags: ["e", "p", "a", "t", "d", "r", "g", "alt"]
    content_validation:
      type: "text"
      max_length: 10000
      min_length: 1
    quality_rules:
      - name: "not_spam"
        weight: 1.0
        description: "Content should not be spam"
      - name: "meaningful_content"
        weight: 0.8
        description: "Content should have meaningful text"
      - name: "proper_encoding"
        weight: 0.9
        description: "Content should be properly encoded"
    replaceable: false
    ephemeral: false

  2: # Recommend relay
    name: "Recommend Relay"
    description: "Recommend a relay to other users"
    required_tags: []
    optional_tags: ["r", "a"]
    content_validation:
      type: "text"
      max_length: 1000
    quality_rules:
      - name: "valid_relay_url"
        weight: 1.0
        description: "Must contain valid relay URL"
      - name: "reasonable_description"
        weight: 0.7
        description: "Should have reasonable description"
    replaceable: false
    ephemeral: false

  3: # Follow list
    name: "Follow List"
    description: "List of followed users"
    required_tags: ["p"]
    optional_tags: []
    content_validation:
      type: "empty"
      max_length: 0
    quality_rules:
      - name: "valid_p_tags"
        weight: 1.0
        description: "All p tags must contain valid pubkeys"
      - name: "reasonable_follow_count"
        weight: 0.8
        description: "Should not have excessive number of follows"
        max_follows: 10000
    replaceable: true
    ephemeral: false

  # Regular event kinds (1000-9999, 4-44, 1, 2)
  4: # Encrypted direct message
    name: "Encrypted Direct Message"
    description: "Encrypted private message"
    required_tags: ["p"]
    optional_tags: ["e"]
    content_validation:
      type: "encrypted"
      max_length: 5000
    quality_rules:
      - name: "valid_encryption"
        weight: 1.0
        description: "Content must be properly encrypted"
      - name: "valid_recipient"
        weight: 1.0
        description: "Must have valid recipient in p tag"
    replaceable: false
    ephemeral: false

  # Replaceable event kinds (10000-19999, 0, 3)
  10000: # Mute list
    name: "Mute List"
    description: "List of muted users"
    required_tags: ["p"]
    optional_tags: []
    content_validation:
      type: "empty"
      max_length: 0
    quality_rules:
      - name: "valid_p_tags"
        weight: 1.0
        description: "All p tags must contain valid pubkeys"
    replaceable: true
    ephemeral: false

  10001: # Relay list metadata
    name: "Relay List Metadata"
    description: "Relay list with metadata"
    required_tags: ["r"]
    optional_tags: ["a"]
    content_validation:
      type: "json"
      max_length: 2000
    quality_rules:
      - name: "valid_json"
        weight: 1.0
        description: "Content must be valid JSON"
      - name: "valid_relay_urls"
        weight: 1.0
        description: "All r tags must contain valid relay URLs"
    replaceable: true
    ephemeral: false

  # Ephemeral event kinds (20000-29999)
  20000: # Client authentication
    name: "Client Authentication"
    description: "Authentication challenge"
    required_tags: []
    optional_tags: []
    content_validation:
      type: "text"
      max_length: 100
    quality_rules:
      - name: "valid_challenge"
        weight: 1.0
        description: "Must be valid authentication challenge"
    replaceable: false
    ephemeral: true

  # Addressable event kinds (30000-39999)
  30000: # Categorized people list
    name: "Categorized People List"
    description: "List of people in a category"
    required_tags: ["d", "p"]
    optional_tags: ["a"]
    content_validation:
      type: "text"
      max_length: 1000
    quality_rules:
      - name: "valid_d_tag"
        weight: 1.0
        description: "Must have valid d tag for categorization"
      - name: "valid_p_tags"
        weight: 1.0
        description: "All p tags must contain valid pubkeys"
    replaceable: false
    ephemeral: false
    addressable: true

  30001: # Categorized bookmark list
    name: "Categorized Bookmark List"
    description: "List of bookmarked events"
    required_tags: ["d", "e"]
    optional_tags: ["a"]
    content_validation:
      type: "text"
      max_length: 1000
    quality_rules:
      - name: "valid_d_tag"
        weight: 1.0
        description: "Must have valid d tag for categorization"
      - name: "valid_e_tags"
        weight: 1.0
        description: "All e tags must contain valid event IDs"
    replaceable: false
    ephemeral: false
    addressable: true

  30040: # Publication Index (NKBIP-01)
    name: "Publication Index"
    description: "Curated publication index defining structure and metadata"
    required_tags: ["d", "title", "a", "auto-update"]
    optional_tags: ["author", "i", "t", "source", "type", "version", "published_on", "published_by", "image", "summary", "p", "E"]
    content_validation:
      type: "empty"
      max_length: 0
      required_fields: []
    quality_rules:
      - name: "valid_d_tag"
        weight: 1.0
        description: "Must have valid d tag for unique identification"
      - name: "valid_title_tag"
        weight: 1.0
        description: "Must have title tag with publication title"
      - name: "valid_a_tags"
        weight: 1.0
        description: "Must have a tags listing events in display order"
      - name: "valid_auto_update"
        weight: 0.8
        description: "Must have auto-update tag with yes|ask|no value"
      - name: "valid_derivative_work"
        weight: 0.9
        description: "For derivative works, must have p and E tags"
    replaceable: false
    ephemeral: false
    addressable: true
    nkbip: "NKBIP-01"

  30041: # Publication Content (NKBIP-01)
    name: "Publication Content"
    description: "Publication sections, chapters, or content pieces"
    required_tags: ["d", "title"]
    optional_tags: ["wikilink"]
    content_validation:
      type: "text"
      max_length: 100000
      min_length: 1
      allowed_formats: ["asciidoc", "markdown", "plain"]
    quality_rules:
      - name: "valid_d_tag"
        weight: 1.0
        description: "Must have valid d tag for section identification"
      - name: "valid_title_tag"
        weight: 1.0
        description: "Must have title tag describing the section"
      - name: "valid_content"
        weight: 0.9
        description: "Content must be displayable text for end users"
      - name: "valid_asciidoc"
        weight: 0.8
        description: "Content may contain AsciiDoc markup"
      - name: "valid_wikilinks"
        weight: 0.7
        description: "Content may contain wikilinks in double brackets"
    replaceable: false
    ephemeral: false
    addressable: false
    nkbip: "NKBIP-01"

  # Special event kinds
  1040: # OpenTimestamps proof
    name: "OpenTimestamps Proof"
    description: "OpenTimestamps attestation for an event"
    required_tags: ["e", "k"]
    optional_tags: []
    content_validation:
      type: "base64"
      max_length: 10000
    quality_rules:
      - name: "valid_ots_proof"
        weight: 1.0
        description: "Must be valid OpenTimestamps proof"
      - name: "valid_event_reference"
        weight: 1.0
        description: "Must reference valid event in e tag"
    replaceable: false
    ephemeral: false

# Global quality control settings
global_quality:
  # Spam detection
  spam_detection:
    enabled: true
    threshold: 0.7
    rules:
      - name: "repetitive_content"
        weight: 0.8
        description: "Detect repetitive or identical content"
      - name: "excessive_mentions"
        weight: 0.6
        description: "Detect excessive use of mentions"
      - name: "suspicious_patterns"
        weight: 0.9
        description: "Detect suspicious posting patterns"

  # Rate limiting
  rate_limiting:
    enabled: true
    events_per_minute: 60
    burst_limit: 10
    per_kind_limits:
      0: 1  # User metadata - very limited
      1: 60  # Text notes - normal limit
      3: 1   # Follow list - very limited
      4: 30  # DMs - moderate limit

  # Content validation
  content_validation:
    max_content_length: 10000
    min_content_length: 1
    allowed_encodings: ["utf-8"]
    forbidden_patterns:
      - "spam_pattern_1"
      - "spam_pattern_2"

  # Tag validation
  tag_validation:
    max_tags_per_event: 100
    max_tag_length: 1000
    required_tag_formats:
      "e": "^[a-f0-9]{64}$"  # Event ID must be 64 hex chars
      "p": "^[a-f0-9]{64}$"  # Pubkey must be 64 hex chars
      "a": "^[0-9]+:[a-f0-9]{64}:.*$"  # Address format

# Relay-specific settings
relay_settings:
  # Storage policies
  storage:
    regular_events: true
    replaceable_events: true
    ephemeral_events: false
    addressable_events: true

  # Retention policies
  retention:
    regular_events: "28d"
    replaceable_events: "7d"
    addressable_events: "28d"

  # Quarantine settings
  quarantine:
    enabled: true
    auto_quarantine_threshold: 0.5
    manual_review_threshold: 0.3
    quarantine_duration: "24h"
